{"version":3,"sources":["main.js"],"names":["htmlElement","constructor","element","this","copy","clone","remove","append","parent","tetragon3d","speed","super","rotationSpeed","clickedId","planes","children","speedMeasure","start","undefined","stop","lastMeasuredAngle","speedArr","avgSpeed","motionData","currentAngle","targetAngle","move","easing","calculateEntryValues","animateRotationY","computeAvgSpeed","length","applyEasing","css","Math","window","animatePlane","computeEasing","threshold","startEase","delay","speedChange","slowAngles","abs","baseSpeed","distance","steps","i","push","parseFloat","toFixed","round","value","computeRotatingTime","rotationTime","flag","floor","measureAngle","Date","arg","getTargetAngle","shift","reduce","a","b","e","shouldChangeDirection","direction","myPlane","planeClickEvent","on","el","$","attr","addClass","target","id","restoreAnimation","one","targetPlane","off","filter","removeClass","myElement"],"mappings":"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","file":"main.js","sourcesContent":["class htmlElement {\n  constructor(element){\n    this.element = element\n  }\n  copy(){\n    return this.element.clone()\n  }\n  remove(){\n    this.element.remove()\n  }\n  append(parent){\n      this.element.append(parent)\n  }\n}\n\nclass tetragon3d extends htmlElement{\n  constructor(element ,speed){\n    super(element);\n    this.rotationSpeed = speed > 1 ? 1 : speed;\n    this.clickedId =  '';\n    this.planes = this.element.children('.face');\n    this.speedMeasure = {\n      start: undefined,\n      stop: undefined,\n      lastMeasuredAngle: undefined,\n      speedArr: [],\n      avgSpeed: undefined\n    };\n    this.motionData = {\n      currentAngle: 0,\n      targetAngle: undefined,\n      move: true\n    };\n    this.easing = [];\n  }\n  calculateEntryValues() {\n    this.speedMeasure.avgSpeed = (30 / ( this.rotationSpeed * 60 ) );\n\n  }\n\n  animateRotationY() {\n\n    if ( !this.speedMeasure.avgSpeed ) this.calculateEntryValues();\n\n    if ( this.motionData.move ){\n\n      let rotationSpeed = this.computeRotatingTime();\n      this.computeAvgSpeed(rotationSpeed);\n\n      if (this.easing.length !== 0) this.applyEasing();\n\n\n      this.motionData.currentAngle -= this.rotationSpeed;\n      this.motionData.currentAngle = this.motionData.currentAngle <= -360 ? 0 : this.motionData.currentAngle;\n\n      this.element.css( \"transform\", ` translateZ(-250px) rotateY(${this.motionData.currentAngle}deg)` );\n\n      // targetAngle is set in click event, so after click event rotation will stop\n\n      if( Math.round(this.motionData.currentAngle) === this.motionData.targetAngle ){\n        this.motionData.move = false;\n        this.element.css( \"transform\", ` translateZ(-250px) rotateY(${this.motionData.targetAngle}deg)` )\n      }\n\n      window.requestAnimationFrame( ()=> this.animateRotationY() )\n    }\n    else {\n      this.animatePlane();\n    }\n  }\n\n\n  computeEasing(direction){\n    let distance = Math.abs( Math.abs(this.motionData.targetAngle) - Math.abs(this.motionData.currentAngle) );\n\n    let steps = distance < 20 ? 5 : 10;\n    let threshold, delay, speed, speedChange, startEase, slowAngles, easing = [];\n    let baseSpeed = this.rotationSpeed;\n\n    switch (true) {\n      case distance <= 10 :\n        delay = 0;\n        break;\n      case distance <= 20 :\n        delay = 3;\n        break;\n      case distance <= 30 :\n        delay = 8;\n        break;\n      case distance <= 40 :\n        delay = 15;\n        break;\n      case distance <= 50 :\n        delay = 24;\n        break;\n      case distance <= 60 :\n        delay = 32;\n        break;\n      case distance <= 70 :\n        delay = 40;\n        break;\n      case distance <= 80 :\n        delay = 50;\n        break;\n      case distance <= 90 :\n        delay = 60;\n        break;\n\n    }\n\n    threshold = ( distance - delay ) / steps;\n    speedChange = baseSpeed/steps;\n    speed = baseSpeed;\n    startEase = direction === \"forth\" ? this.motionData.currentAngle - delay : this.motionData.currentAngle + delay;\n    slowAngles = startEase;\n\n    threshold = direction === \"forth\" ? -threshold : threshold;\n\n\n    for(let i = 1; i < steps; i++){\n      slowAngles += threshold;\n      speed -= speedChange;\n\n      if ( speed > 0 ) speed = speed < 0.15 ? 0.15 : speed;\n      else speed = speed > -0.15 ? -0.15 : speed;\n\n      easing[i-1] = [];\n\n      easing[i-1].push( Math.round( slowAngles ) );\n      easing[i-1].push( parseFloat( speed.toFixed(2) ) );\n    }\n    return easing;\n\n  }\n  applyEasing(){\n\n    this.easing.forEach(  value => {\n      if ( Math.round(this.motionData.currentAngle) === value[0] )\n        this.rotationSpeed = value[1];\n    })\n  }\n  computeRotatingTime(){\n\n    let currentAngle = Math.abs( Math.floor(this.motionData.currentAngle) );\n    let rotationTime;\n    let flag = !(currentAngle % 31);\n\n\n    // return if current angle haven't change from last measurement\n    if (this.speedMeasure.lastMeasuredAngle === currentAngle){\n      return null;\n    }\n\n\n    this.speedMeasure.lastMeasuredAngle = currentAngle;\n\n\n    if(this.speedMeasure.measureAngle === currentAngle){\n      this.speedMeasure.stop = new Date();\n      rotationTime =  (this.speedMeasure.stop - this.speedMeasure.start)/1000;\n      return rotationTime;\n    }\n    //every 31 degrees start time, and angle, at which speed will be measured, are set\n    if ( flag ) {\n      this.speedMeasure.measureAngle = this.motionData.currentAngle === 360 ? 30 : currentAngle + 30;\n      this.speedMeasure.start = new Date();\n    }\n    return null\n  }\n  computeAvgSpeed(arg){\n\n    if ( arg === null ) return;\n\n    this.speedMeasure.speedArr.push(arg);\n\n    if ( this.speedMeasure.speedArr.length > 4 ){\n      this.speedMeasure.speedArr.shift();\n\n    }\n    this.speedMeasure.avgSpeed = this.speedMeasure.speedArr.reduce((a,b) => a + b, 0) / this.speedMeasure.speedArr.length;\n\n  }\n\n  getTargetAngle (e) {\n\n    const targetId = $(e.target).attr(\"id\");\n\n    switch (targetId) {\n      case \"front\":\n        this.motionData.targetAngle = 0;\n        break;\n      case \"right\":\n        this.motionData.targetAngle = -90;\n        break;\n      case \"back\":\n        this.motionData.targetAngle = -180;\n        break;\n      case \"left\":\n        this.motionData.targetAngle = -270;\n        break;\n    }\n  }\n  shouldChangeDirection(){\n    let direction = \"forth\";\n    if( this.motionData.targetAngle === 0 ){\n      //if clicked in front plane, which set target angle to 0 , must have special check, cause current angle is always lesser than 0\n      this.rotationSpeed = this.motionData.currentAngle < -180 ? this.rotationSpeed : -this.rotationSpeed;\n      direction = this.motionData.currentAngle < -180 ? \"forth\" :  \"back\"\n    } else if ( this.motionData.currentAngle < this.motionData.targetAngle ){\n      //all the other cases\n      this.rotationSpeed = -this.rotationSpeed;\n      direction = \"back\"\n    }\n    return direction\n  }\n\n  animatePlane(){\n\n    let myPlane = this.planes.filter( ( i,el ) => $(el).attr('id') === this.clickedId);\n\n    myPlane.addClass(\"focus\")\n  }\n\n  planeClickEvent(flag){\n    if(flag){\n      this.planes.on( 'click', (e)=> {\n        e.stopPropagation();\n        this.getTargetAngle(e);\n        this.clickedId = e.target.id;\n\n        let direction = this.shouldChangeDirection();\n        this.easing = this.computeEasing(direction);\n\n        $(e.target).css('cursor', 'initial');\n\n        $('body')\n          .css('cursor', 'pointer')\n          .one('click', (e) => {\n            $(e.target).css('cursor', 'initial')\n            this.restoreAnimation();\n          });\n\n      } )\n    } else {\n      this.planes.off()\n    }\n\n  }\n\n  restoreAnimation(){\n    let targetPlane = this.planes\n      .filter( ( i,el ) => $(el).attr('id') === this.clickedId);\n      targetPlane.removeClass(\"focus\");\n    this.easing = [];\n    this.motionData.move = true;\n    this.motionData.targetAngle = undefined;\n    this.clickedId = '';\n\n    targetPlane.one('transitionend',  () => {\n      this.animateRotationY();\n    })\n\n  }\n\n}\n\nlet myElement = new tetragon3d($('#top-layer'),.5);\n\n$(() => {\n\n\n  myElement.animateRotationY();\n  myElement.planeClickEvent(true);\n\n});"]}